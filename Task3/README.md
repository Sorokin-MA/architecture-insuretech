# Риски и проблемы при росте нагрузки

## Исходные условия

- core-app и ins-comp-settlement получают данные через REST от ins-product-aggregator
- core-app кэширует продукты каждые 15 минут; ins-comp-settlement — раз в сутки
- ins-product-aggregator синхронно дергает страховые компании для агрегации
- Планируется рост до 10 провайдеров

## Основные проблемы

- Синхронный фан-аут к множеству провайдеров увеличивает время ответа и таймауты
- Отсутствие изоляции и лимитов на каждого провайдера → один провайдер может замедлить весь агрегатор
- Жёсткая связность между агрегатором и потребителями, зависимость от онлайн-доступности
- Отсрочка обновлений, вызывающая окна несвежих данных и пиковые нагрузки при батчах
- Риск потери данных и проблемы идемпотентности при экспорте оформленных страховок
- Единый канал API для партнеров без квот и ограничения → риск перегрузки

## Риски масштабирования

- Увеличение задержек и таймаутов при росте числа провайдеров
- Сложность ретраев и идемпотентности без унификации
- Рост объёма и частоты обновлений кэша
- Пиковые ночные нагрузки и точки отказа в агрегаторе и core-app

## Предложенные изменения

- Перевести продуктовые данные на event streaming (ProductUpdated, TariffUpdated, ProviderStatus)
- Использовать per-provider circuit breaker, timeouts и rate limiting
- Внедрить Transactional Outbox для надёжной публикации событий
- Обеспечить идемпотентность операций оформления и экспорта
- Разделить ночные реестры на события для более гибкой обработки

## Ожидаемый эффект

- Снижение высоких задержек чтения за счёт локальных read-моделей
- Устойчивость к сбоям внешних провайдеров без каскадных эффектов
- Сглаживание пиков и равномерная нагрузка благодаря событийной репликации
